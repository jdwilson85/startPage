<script>
    async function initWeather() {
        try {
            const latitude = {{ site.weather.latitude }};
            const longitude = {{ site.weather.longitude }};
            const unit = {{ site.weather.unit | jsonify }};

            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current_weather=true&temperature_unit=${unit}`);
            const data = await res.json();
            const { temperature, weathercode } = data.current_weather;

            const iconMap = {
                0: 'fa-sun', 1: 'fa-cloud-sun', 2: 'fa-cloud-sun', 3: 'fa-cloud',
                45: 'fa-smog', 48: 'fa-smog',
                51: 'fa-cloud-rain', 53: 'fa-cloud-rain', 55: 'fa-cloud-rain',
                61: 'fa-cloud-showers-heavy', 63: 'fa-cloud-showers-heavy', 65: 'fa-cloud-showers-heavy',
                71: 'fa-snowflake', 73: 'fa-snowflake', 75: 'fa-snowflake',
                80: 'fa-cloud-rain', 81: 'fa-cloud-rain', 82: 'fa-cloud-rain',
                95: 'fa-bolt', 96: 'fa-bolt', 99: 'fa-bolt'
            };

            const unitSymbol = unit === 'fahrenheit' ? 'F' : 'C';
            const iconClass = iconMap[weathercode] || 'fa-cloud';
            document.getElementById('weather-icon').className = `fa-solid ${iconClass} text-vscode-accent`;
            document.getElementById('weather-text').textContent = `${temperature}Â°${unitSymbol}`;
            document.getElementById('weather').classList.remove('hidden');
        } catch (e) {
            console.error('Weather error:', e);
        }
    }
</script>
